from flask import Flask, jsonify
import pyodbc
import base64

app = Flask(__name__)

@app.route('/getdata')
def getdata():
    try:
        conn = pyodbc.connect(
            "DRIVER={ODBC Driver 17 for SQL Server};"
            "SERVER=localhost;"
            "DATABASE=ED-02;"
            "Trusted_Connection=yes;"
        )
        cursor = conn.cursor()
        cursor.execute("SELECT TOP 10 * FROM dbo._modul")  # ganti nama tabel kamu

        columns = [column[0] for column in cursor.description]
        rows = cursor.fetchall()

        # kolom yang kamu mau
        keep = {"msisdn", "temp", "active"}

        results = []
        for row in rows:
            row_dict = {}
            for i, value in enumerate(row):
                col = columns[i]
                if col not in keep:
                    continue  # skip kolom lain
                if isinstance(value, bytes):
                    value = base64.b64encode(value).decode('utf-8')
                row_dict[col] = value
            results.append(row_dict)

        return jsonify(results)
    except Exception as e:
        return jsonify({"error": str(e)})

if __name__ == '__main__':
    app.run()
